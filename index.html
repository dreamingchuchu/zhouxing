<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY WORLD</title>
    <style>
        :root {
            --base-black: #050406;
            --neon-purple: #9b4dff;
            --white: #ffffff;
            --bg-overlay: rgba(0, 0, 0, 0.4);
            --grid-line: rgba(255, 255, 255, 0.15);
        }

        #master-frame {
            position: fixed; inset: 0; z-index: 9999; pointer-events: none;
            border: 60px solid transparent;
            border-image: url('bg.jpg') 100 round;
        }

        html { scroll-behavior: smooth; }
        body {
            margin: 0; padding: 0; background: var(--base-black);
            background-image: url('frame.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--white); font-family: 'Georgia', serif;
            overflow-x: hidden; scroll-snap-type: y proximity;
        }
        body::after { content: ""; position: fixed; inset: 0; background: var(--bg-overlay); z-index: -1; }

        section { width: 100vw; height: 100vh; position: relative; display: flex; justify-content: center; align-items: center; scroll-snap-align: start; }

        /* P1 */
        .oc-wrapper { position: relative; width: 400px; height: 600px; cursor: crosshair; }
        .slice { position: absolute; inset: 0; background-size: cover; background-position: center; filter: grayscale(1); transition: 0.8s; }
        .s1 { clip-path: polygon(0 0, 100% 0, 100% 32%, 0 45%); }
        .s2 { clip-path: polygon(0 47%, 100% 34%, 100% 70%, 0 82%); }
        .s3 { clip-path: polygon(0 84%, 100% 72%, 100% 100%, 0 100%); }
        .oc-wrapper:hover .slice { filter: grayscale(0); }
        .oc-wrapper:hover .s1 { transform: translate(-30px, -20px); }
        .oc-wrapper:hover .s2 { transform: translate(30px, 0); }
        .oc-wrapper:hover .s3 { transform: translate(-15px, 20px); }
        #auto-scanner { position: absolute; width: 150px; height: 150px; border: 1px solid #fff; border-radius: 50%; z-index: 20; pointer-events: none; box-shadow: 0 0 20px var(--neon-purple); background-repeat: no-repeat; background-size: 800px 1200px; }

        /* P2 */
        #page2 { display: flex; align-items: center; justify-content: center; padding: 0 10%; box-sizing: border-box; }
        .p2-floating-wrap { display: flex; width: 100%; height: 80vh; animation: floatEffect 6s ease-in-out infinite; }
        @keyframes floatEffect { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        .p2-left { flex: 1.2; display: flex; flex-direction: column; height: 100%; gap: 20px; }
        .music-player { flex: 2; background: rgba(0,0,0,0.8); border: 1px solid var(--grid-line); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; padding: 20px; }
        .player-cover { width: 220px; height: 220px; background: url('music_cover.jpg') center; background-size: cover; border: 1px solid #444; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .progress-area { width: 80%; margin-bottom: 15px; }
        .bar-bg { width: 100%; height: 2px; background: #333; position: relative; }
        .bar-fill { position: absolute; left: 0; top: 0; height: 100%; width: 45%; background: var(--neon-purple); box-shadow: 0 0 10px var(--neon-purple); animation: progressMock 10s linear infinite; }
        @keyframes progressMock { from { width: 0%; } to { width: 100%; } }
        .player-controls { display: flex; gap: 25px; align-items: center; }
        .ctrl-btn { cursor: pointer; opacity: 0.8; transition: 0.2s; fill: white; width: 20px; height: 20px; }
        .ctrl-btn:hover { opacity: 1; transform: scale(1.1); }
        .social-icons { flex: 1; display: flex; gap: 60px; justify-content: center; align-items: center; background: rgba(255,255,255,0.02); border: 1px solid var(--grid-line); }
        .social-icons svg { width: 45px; height: 45px; fill: #fff; opacity: 0.9; }
        .p2-right { flex: 1; position: relative; height: 100%; }
        .p2-img-box { position: absolute; background: #111; border: 2px solid #fff; overflow: hidden; cursor: pointer; transition: 0.5s; }
        .p2-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .box-1 { width: 220px; height: 300px; top: 5%; left: 10%; transform: rotate(-5deg); z-index: 3; }
        .box-2 { width: 250px; height: 200px; top: 40%; left: 45%; transform: rotate(8deg); z-index: 2; }
        .box-3 { width: 200px; height: 280px; bottom: 5%; left: 15%; transform: rotate(-2deg); z-index: 1; }
        .p2-img-box:hover { transform: rotate(0deg) scale(1.05); z-index: 10; border-color: var(--neon-purple); }

        /* P3 Bento Grid */
        #page3 { height: 100vh; display: flex; align-items: center; justify-content: center; }
        .bento-container { width: 70vw; height: 65vh; display: flex; flex-direction: column; }
        .bento-grid { display: grid; flex: 1; gap: 10px; grid-template-columns: repeat(9, 1fr); grid-template-rows: repeat(10, 1fr); }
        .bento-item { background: #111; overflow: hidden; border: 1px solid var(--grid-line); cursor: pointer; position: relative; }
        .bento-item img { width: 100%; height: 100%; object-fit: cover; transform: scale(1.05); object-position: center var(--pos-y, 50%); filter: grayscale(1); transition: 0.6s; pointer-events: none; }
        body:not(.is-editing) .bento-item:hover img { filter: grayscale(0); transform: scale(1.15) rotate(var(--r-angle, 2deg)); z-index: 10; }
        .is-editing .bento-item img { filter: grayscale(0); pointer-events: auto; transform: scale(1.3); }
        .b1_top { grid-column: 1 / 3; grid-row: 1 / 6; } .b1_bot { grid-column: 1 / 3; grid-row: 6 / 11; }
        .b2 { grid-column: 3 / 5; grid-row: 1 / 7; } .b3 { grid-column: 5 / 8; grid-row: 1 / 4; } 
        .b4 { grid-column: 5 / 6; grid-row: 4 / 7; } .b5 { grid-column: 6 / 8; grid-row: 4 / 6; } 
        .b6 { grid-column: 3 / 6; grid-row: 7 / 11; } .b7 { grid-column: 6 / 8; grid-row: 6 / 11; } 
        .b8 { grid-column: 8 / 10; grid-row: 1 / 4; } .b9 { grid-column: 8 / 10; grid-row: 4 / 11; } 

        /* UI */
        #lightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        #lbImg { max-width: 65%; max-height: 70vh; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); transition: 0.4s; }
        .ui-panel { position: fixed; bottom: 40px; left: 80px; z-index: 10005; display: flex; gap: 10px; }
        .btn { background: #000; border: 1px solid #fff; color: #fff; padding: 10px 20px; cursor: pointer; font-size: 11px; letter-spacing: 2px; }
        #save-indicator { position: fixed; bottom: 45px; left: 350px; font-size: 10px; color: var(--neon-purple); opacity: 0; transition: 0.5s; }
    </style>
</head>
<body>

<div id="master-frame"></div>
<div id="lightbox" onclick="closeLightbox()"><img src="" id="lbImg"></div>
<div id="save-indicator">ARCHIVE SYNCED...</div>

<div class="ui-panel">
    <button id="editBtn" class="btn" onclick="toggleEditMode()">EDIT ARCHIVE</button>
    <button class="btn" onclick="clearAllData()" style="border-color: #444; color: #888;">FORCE RESET</button>
</div>

<section id="page1"><div class="oc-wrapper" onclick="handleCellClick('oc')"><div class="slice s1"></div><div class="slice s2"></div><div class="slice s3"></div><div id="auto-scanner"></div></div></section>
<section id="page2">
    <div class="p2-floating-wrap">
        <div class="p2-left">
            <div class="music-player"><div class="player-cover"></div><div class="progress-area"><div class="bar-bg"><div class="bar-fill"></div></div></div></div>
            <div class="social-icons">
                <svg viewBox="0 0 24 24"><path d="M8.35 4.34C4.31 4.34 1 7.15 1 10.63c0 1.95 1.04 3.7 2.68 4.93l-.67 2.45 2.58-1.29c.89.24 1.83.37 2.8.37.28 0 .55-.02.81-.05-.44-.7-.69-1.52-.69-2.39 0-2.58 2.29-4.68 5.12-4.68.42 0 .82.05 1.21.14C13.8 6.55 11.3 4.34 8.35 4.34zm-2.06 4.3c.53 0 .96.43.96.96 0 .53-.43.96-.96.96-.53 0-.96-.43-.96-.96 0-.53.43-.96.96-.96zm4.84 0c.53 0 .96.43.96.96 0 .53-.43.96-.96.96-.53 0-.96-.43-.96-.96 0-.53.43-.96.96-.96zm11.87 6.13c0-2.91-2.77-5.27-6.18-5.27-3.41 0-6.18 2.36-6.18 5.27 0 2.91 2.77 5.27 6.18 5.27.79 0 1.55-.13 2.24-.36l2.09 1.05-.54-1.99c1.44-1 2.39-2.42 2.39-3.97zm-8.21-1.12c-.42 0-.76-.34-.76-.76 0-.42.34-.76.76-.76.42 0 .76.34.76.76 0 .42-.34.76-.76.76zm4.05 0c-.42 0-.76-.34-.76-.76 0-.42.34-.76.76-.76.42 0 .76.34.76.76 0 .42-.34.76-.76.76z"/></svg>
            </div>
        </div>
        <div class="p2-right" id="p2ImageBox">
            <div class="p2-img-box box-1" onclick="handleCellClick('p2', 0)"></div>
            <div class="p2-img-box box-2" onclick="handleCellClick('p2', 1)"></div>
            <div class="p2-img-box box-3" onclick="handleCellClick('p2', 2)"></div>
        </div>
    </div>
</section>
<section id="page3"><div class="bento-container"><div class="bento-grid" id="bentoBox"></div></div></section>

<input type="file" id="fileInput" style="display:none" accept="image/*">

<script>
    const KEY = 'GOTHIC_VAULT_V35_FINAL'; 
    let isEdit = false;
    let dragData = { isDragging: false, targetIdx: -1 };

    // 这里是所有图片的默认设置
    const fallback = {
        oc: 'hero.jpg',
        p2Images: ['p2_1.jpg', 'p2_2.jpg', 'p2_3.jpg'],
        bento: ['b1.jpg', 'b7.jpg', 'b2.jpg', 'b3.jpg', 'b4.jpg', 'b6.jpg', 'b10.jpg', 'b5.jpg', 'b9.jpg', 'b8.jpg'],
        bentoPos: Array(10).fill(50)
    };

    let db = JSON.parse(localStorage.getItem(KEY)) || fallback;

    function saveToDisk() {
        try {
            localStorage.setItem(KEY, JSON.stringify(db));
            showIndicator();
        } catch (e) { console.error(e); }
    }

    function showIndicator() { const ind = document.getElementById('save-indicator'); ind.style.opacity = 1; setTimeout(() => ind.style.opacity = 0, 2000); }

    function clearAllData() { if(confirm("Confirm reset?")) { localStorage.removeItem(KEY); location.reload(); } }

    function processImage(file, callback) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = img.width, height = img.height, max = 800;
                if (width > max) { height = (max / width) * height; width = max; }
                canvas.width = width; canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                callback(canvas.toDataURL('image/jpeg', 0.6));
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    function toggleEditMode() {
        isEdit = !isEdit;
        document.body.classList.toggle('is-editing', isEdit);
        document.getElementById('editBtn').innerText = isEdit ? "LOCK & SAVE" : "EDIT ARCHIVE";
        if(!isEdit) saveToDisk();
        render();
    }

    function handleCellClick(type, idx = 0) {
        if(isEdit) {
            const input = document.getElementById('fileInput');
            input.onchange = (e) => {
                const file = e.target.files[0];
                if(!file) return;
                processImage(file, (compressedBase64) => {
                    if(type === 'oc') db.oc = compressedBase64;
                    else if(type === 'p2') db.p2Images[idx] = compressedBase64;
                    else if(type === 'bento') { db.bento[idx] = compressedBase64; db.bentoPos[idx] = 50; }
                    saveToDisk(); render();
                });
            };
            input.click();
        } else {
            let src = type === 'oc' ? db.oc : (type === 'p2' ? db.p2Images[idx] : db.bento[idx]);
            if(src && src.length > 5) openLightbox(src);
        }
    }

    function render() {
        document.querySelectorAll('.slice').forEach(s => s.style.backgroundImage = `url(${db.oc})`);
        document.getElementById('auto-scanner').style.backgroundImage = `url(${db.oc})`;
        const p2Boxes = document.querySelectorAll('.p2-img-box');
        p2Boxes.forEach((box, i) => box.innerHTML = `<img src="${db.p2Images[i]}">`);
        const bb = document.getElementById('bentoBox');
        const layouts = ['b1_top','b1_bot','b2','b3','b4','b5','b6','b7','b8','b9'];
        bb.innerHTML = layouts.map((cls, i) => {
            const randomAngle = (Math.random() * 4 - 2).toFixed(2); 
            return `<div class="bento-item ${cls}" onclick="handleCellClick('bento', ${i})" style="--r-angle: ${randomAngle}deg">
                <img src="${db.bento[i]}" style="--pos-y: ${db.bentoPos[i]}%" onmousedown="startDrag(event, ${i})">
            </div>`;
        }).join('');
    }

    function startDrag(e, idx) {
        if(!isEdit) return; e.preventDefault();
        dragData.isDragging = true; dragData.targetIdx = idx;
        const startY = e.clientY, startPos = db.bentoPos[idx];
        const onMove = (me) => {
            if(!dragData.isDragging) return;
            const delta = (me.clientY - startY) / 4; 
            db.bentoPos[dragData.targetIdx] = Math.max(0, Math.min(100, startPos - delta));
            const img = document.querySelectorAll('.bento-item img')[dragData.targetIdx];
            if(img) img.style.setProperty('--pos-y', db.bentoPos[dragData.targetIdx] + '%');
        };
        const onUp = () => { dragData.isDragging = false; saveToDisk(); window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', onUp); };
        window.addEventListener('mousemove', onMove); window.addEventListener('mouseup', onUp);
    }

    function openLightbox(src) {
        const lb = document.getElementById('lightbox'), img = document.getElementById('lbImg');
        img.src = src; lb.style.display = 'flex';
        setTimeout(() => lb.classList.add('active'), 10);
    }

    function closeLightbox() {
        const lb = document.getElementById('lightbox');
        lb.classList.remove('active');
        setTimeout(() => lb.style.display = 'none', 300);
    }

    window.onload = () => { render(); let angle = 0; const scan = document.getElementById('auto-scanner'); function anim() { angle += 0.012; const x = 50 + Math.cos(angle)*35, y = 50 + Math.sin(angle*0.8)*40; if(scan){ scan.style.left = `calc(${x}% - 75px)`; scan.style.top = `calc(${y}% - 75px)`; scan.style.backgroundPosition = `${x}% ${y}%`; } requestAnimationFrame(anim); } anim(); };
</script>
</body>

</html>






